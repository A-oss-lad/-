<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>江西粤东气象社区交流安全中心 - 违规处罚通知</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1e40af',
            secondary: '#3b82f6',
            accent: '#60a5fa',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .bg-gradient-blue {
        background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen pb-20">
  <!-- 顶部标题区域 -->
  <header class="bg-gradient-blue text-white py-4 px-4">
    <div class="container mx-auto">
      <div class="flex items-center">
        <h1 class="text-lg font-bold">违规处罚通知</h1>
      </div>
    </div>
  </header>

  <!-- 内容区域 -->
  <main class="container mx-auto px-4 py-6">
    <!-- 处罚通知说明 -->
    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6">
      <div class="flex">
        <div class="flex-shrink-0">
          <i class="fa fa-exclamation-circle text-yellow-500"></i>
        </div>
        <div class="ml-3">
          <p class="text-sm text-yellow-700">
            此处显示您收到的违规处罚通知。如对处罚有异议，可在处罚通知详情页提交申诉。
          </p>
        </div>
      </div>
    </div>

    <!-- 处罚通知列表 -->
    <div id="punishmentList" class="space-y-4">
      <!-- 处罚通知卡片将通过JavaScript动态生成 -->
    </div>

    <!-- 无数据提示 -->
    <div id="noData" class="hidden bg-white rounded-lg shadow-md p-8 text-center">
      <i class="fa fa-check-circle text-green-300 text-5xl mb-4"></i>
      <p class="text-gray-500">暂无处罚通知</p>
      <p class="text-sm text-gray-400 mt-2">您的账号状态良好，请继续遵守社区规范</p>
    </div>
  </main>

  <!-- 处罚详情模态框 -->
  <div id="punishmentDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-lg max-h-[90vh] overflow-y-auto">
      <div class="p-4 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white z-10">
        <h3 class="text-lg font-semibold text-gray-800">处罚详情</h3>
        <button id="closeDetailModal" class="text-gray-500 hover:text-gray-700">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div id="punishmentDetailContent" class="p-4 space-y-4">
        <!-- 处罚详情内容将通过JavaScript动态生成 -->
      </div>
      <div class="p-4 border-t border-gray-200 flex justify-end">
        <button id="appealBtn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors duration-200">
          提交申诉
        </button>
      </div>
    </div>
  </div>

  <!-- 底部导航栏 -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg">
    <div class="flex justify-around">
      <a href="index.html" class="nav-link flex flex-col items-center py-2 px-4 text-gray-600">
        <i class="fa fa-home text-xl"></i>
        <span class="text-xs mt-1">首页</span>
      </a>
      <a href="report.html" class="nav-link flex flex-col items-center py-2 px-4 text-gray-600">
        <i class="fa fa-flag text-xl"></i>
        <span class="text-xs mt-1">我要举报</span>
      </a>
      <a href="progress.html" class="nav-link flex flex-col items-center py-2 px-4 text-gray-600">
        <i class="fa fa-tasks text-xl"></i>
        <span class="text-xs mt-1">处理进度</span>
      </a>
      <a href="more.html" class="nav-link flex flex-col items-center py-2 px-4 text-gray-600">
        <i class="fa fa-ellipsis-h text-xl"></i>
        <span class="text-xs mt-1">更多</span>
      </a>
      <a href="profile.html" class="nav-link flex flex-col items-center py-2 px-4 text-gray-600">
        <i class="fa fa-user text-xl"></i>
        <span class="text-xs mt-1">我的</span>
      </a>
    </div>
  </nav>

  <!-- 引入通用脚本 -->
  <script src="script.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const currentUser = AuthManager.getCurrentUser();
      if (!currentUser) {
        Utils.showMessage('请先登录', 'error');
        return;
      }

      // 获取用户的处罚记录
      let punishments = DataManager.getPunishmentsByUserId(currentUser.id);
      const punishmentList = document.getElementById('punishmentList');
      const noData = document.getElementById('noData');

      // 渲染处罚列表
      function renderPunishments() {
        if (punishments.length === 0) {
          punishmentList.classList.add('hidden');
          noData.classList.remove('hidden');
          return;
        }

        punishmentList.classList.remove('hidden');
        noData.classList.add('hidden');

        punishmentList.innerHTML = '';
        punishments.forEach(punishment => {
          const statusClass = punishment.status === 'active' ? 'bg-red-100 text-red-800' : 
                             punishment.status === 'appealed' ? 'bg-yellow-100 text-yellow-800' : 
                             'bg-gray-100 text-gray-800';
          const statusText = punishment.status === 'active' ? '处罚中' : 
                            punishment.status === 'appealed' ? '申诉中' : 
                            '已撤销';

          const typeText = punishment.type === 'ban' ? '封禁' : 
                          punishment.type === 'mute' ? '禁言' : '警告';

          const punishmentCard = document.createElement('div');
          punishmentCard.className = 'bg-white rounded-lg shadow-md p-4';
          punishmentCard.innerHTML = `
            <div class="flex justify-between items-start">
              <div>
                <div class="flex items-center">
                  <h3 class="text-md font-semibold text-gray-800">${typeText}处罚</h3>
                  <span class="inline-block px-2 py-1 ${statusClass} text-xs rounded-full ml-2">${statusText}</span>
                </div>
                <p class="text-sm text-gray-600 mt-1">原因: ${punishment.reason}</p>
                <p class="text-sm text-gray-600 mt-1">时间: ${Utils.formatDate(punishment.startTime)} ${punishment.endTime ? `至 ${Utils.formatDate(punishment.endTime)}` : '永久'}</p>
              </div>
              <button class="view-detail px-3 py-1 bg-gray-100 text-gray-700 rounded-md text-sm hover:bg-gray-200 transition-colors duration-200" data-id="${punishment.id}">
                查看详情
              </button>
            </div>
          `;
          punishmentList.appendChild(punishmentCard);

          // 查看详情按钮点击事件
          punishmentCard.querySelector('.view-detail').addEventListener('click', () => {
            showPunishmentDetail(punishment.id);
          });
        });
      }

      // 显示处罚详情
      function showPunishmentDetail(punishmentId) {
        const punishment = DataManager.getPunishments().find(p => p.id === punishmentId);
        if (!punishment) return;

        const modal = document.getElementById('punishmentDetailModal');
        const content = document.getElementById('punishmentDetailContent');
        const appealBtn = document.getElementById('appealBtn');

        const statusClass = punishment.status === 'active' ? 'bg-red-100 text-red-800' : 
                           punishment.status === 'appealed' ? 'bg-yellow-100 text-yellow-800' : 
                           'bg-gray-100 text-gray-800';
        const statusText = punishment.status === 'active' ? '处罚中' : 
                          punishment.status === 'appealed' ? '申诉中' : 
                          '已撤销';

        const typeText = punishment.type === 'ban' ? '封禁' : 
                        punishment.type === 'mute' ? '禁言' : '警告';

        // 生成AI解释
        const explanation = Utils.generateViolationExplanation(punishment.reason, punishment.reason);

        content.innerHTML = `
          <div>
            <h4 class="text-sm font-medium text-gray-500">处罚类型</h4>
            <p class="text-gray-800">${typeText}</p>
          </div>
          <div>
            <h4 class="text-sm font-medium text-gray-500">处罚原因</h4>
            <p class="text-gray-800">${punishment.reason}</p>
          </div>
          <div>
            <h4 class="text-sm font-medium text-gray-500">处罚时长</h4>
            <p class="text-gray-800">${punishment.duration}</p>
          </div>
          <div>
            <h4 class="text-sm font-medium text-gray-500">生效时间</h4>
            <p class="text-gray-800">${Utils.formatDate(punishment.startTime)}</p>
          </div>
          ${punishment.endTime ? `
          <div>
            <h4 class="text-sm font-medium text-gray-500">解封时间</h4>
            <p class="text-gray-800">${Utils.formatDate(punishment.endTime)}</p>
          </div>
          ` : ''}
          <div>
            <h4 class="text-sm font-medium text-gray-500">处罚状态</h4>
            <span class="inline-block px-2 py-1 ${statusClass} text-xs rounded-full">${statusText}</span>
          </div>
          <div>
            <h4 class="text-sm font-medium text-gray-500">具体解释</h4>
            <div class="mt-2 p-3 bg-blue-50 rounded-md">
              <p class="text-gray-800 text-sm">${explanation}</p>
            </div>
          </div>
          ${punishment.status === 'appealed' ? `
          <div>
            <h4 class="text-sm font-medium text-gray-500">申诉状态</h4>
            <p class="text-gray-800">您已提交申诉，正在处理中</p>
          </div>
          ` : ''}
          ${punishment.status === 'revoked' ? `
          <div>
            <h4 class="text-sm font-medium text-gray-500">申诉结果</h4>
            <p class="text-gray-800">申诉成功，处罚已撤销</p>
          </div>
          ` : ''}
        `;

        // 控制申诉按钮显示
        if (punishment.status === 'active') {
          appealBtn.classList.remove('hidden');
          appealBtn.onclick = () => {
            modal.classList.add('hidden');
            window.location.href = `appeal.html?punishmentId=${punishment.id}`;
          };
        } else {
          appealBtn.classList.add('hidden');
        }

        modal.classList.remove('hidden');
      }

      // 关闭详情模态框
      document.getElementById('closeDetailModal').addEventListener('click', () => {
        document.getElementById('punishmentDetailModal').classList.add('hidden');
      });

      // 初始渲染
      renderPunishments();
    });
  </script>
</body>
</html>