<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>江西粤东气象社区交流安全中心 - 处理进度</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1e40af',
            secondary: '#3b82f6',
            accent: '#60a5fa',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .bg-gradient-blue {
        background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen pb-20">
  <!-- 顶部标题区域 -->
  <header class="bg-gradient-blue text-white py-4 px-4">
    <div class="container mx-auto">
      <div class="flex items-center">
        <h1 class="text-lg font-bold">处理进度</h1>
      </div>
    </div>
  </header>

  <!-- 内容区域 -->
  <main class="container mx-auto px-4 py-6">
    <!-- 筛选器 -->
    <div class="bg-white rounded-lg shadow-md p-4 mb-6">
      <div class="flex items-center justify-between">
        <h3 class="text-md font-semibold text-gray-800">筛选</h3>
        <button id="resetFilter" class="text-sm text-primary hover:text-secondary">
          <i class="fa fa-refresh mr-1"></i> 重置
        </button>
      </div>
      <div class="mt-3 grid grid-cols-2 gap-3">
        <div>
          <label for="statusFilter" class="block text-xs font-medium text-gray-700 mb-1">处理状态</label>
          <select id="statusFilter" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
            <option value="">全部</option>
            <option value="processing">处理中</option>
            <option value="completed">已处理</option>
          </select>
        </div>
        <div>
          <label for="typeFilter" class="block text-xs font-medium text-gray-700 mb-1">违规类型</label>
          <select id="typeFilter" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
            <option value="">全部</option>
            <option value="色情低容/资源">色情低容/资源</option>
            <option value="政治敏感">政治敏感</option>
            <option value="辱骂/侮辱他人">辱骂/侮辱他人</option>
            <option value="虚假/谣言信息">虚假/谣言信息</option>
            <option value="无关的广告信息">无关的广告信息</option>
            <option value="私信骚扰">私信骚扰</option>
            <option value="其他">其他</option>
          </select>
        </div>
      </div>
    </div>

    <!-- 举报列表 -->
    <div id="reportList" class="space-y-4">
      <!-- 举报卡片将通过JavaScript动态生成 -->
    </div>

    <!-- 无数据提示 -->
    <div id="noData" class="hidden bg-white rounded-lg shadow-md p-8 text-center">
      <i class="fa fa-inbox text-gray-300 text-5xl mb-4"></i>
      <p class="text-gray-500">暂无举报记录</p>
      <a href="report.html" class="mt-4 inline-block px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors duration-200">
        去举报
      </a>
    </div>
  </main>

  <!-- 举报详情模态框 -->
  <div id="reportDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-lg max-h-[90vh] overflow-y-auto">
      <div class="p-4 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white z-10">
        <h3 class="text-lg font-semibold text-gray-800">举报详情</h3>
        <button id="closeDetailModal" class="text-gray-500 hover:text-gray-700">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div id="reportDetailContent" class="p-4 space-y-4">
        <!-- 举报详情内容将通过JavaScript动态生成 -->
      </div>
    </div>
  </div>

  <!-- 底部导航栏 -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg">
    <div class="flex justify-around">
      <a href="index.html" class="nav-link flex flex-col items-center py-2 px-4 text-gray-600">
        <i class="fa fa-home text-xl"></i>
        <span class="text-xs mt-1">首页</span>
      </a>
      <a href="report.html" class="nav-link flex flex-col items-center py-2 px-4 text-gray-600">
        <i class="fa fa-flag text-xl"></i>
        <span class="text-xs mt-1">我要举报</span>
      </a>
      <a href="progress.html" class="nav-link flex flex-col items-center py-2 px-4 text-primary">
        <i class="fa fa-tasks text-xl"></i>
        <span class="text-xs mt-1">处理进度</span>
      </a>
      <a href="more.html" class="nav-link flex flex-col items-center py-2 px-4 text-gray-600">
        <i class="fa fa-ellipsis-h text-xl"></i>
        <span class="text-xs mt-1">更多</span>
      </a>
      <a href="profile.html" class="nav-link flex flex-col items-center py-2 px-4 text-gray-600">
        <i class="fa fa-user text-xl"></i>
        <span class="text-xs mt-1">我的</span>
      </a>
    </div>
  </nav>

  <!-- 引入通用脚本 -->
  <script src="script.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const currentUser = AuthManager.getCurrentUser();
      if (!currentUser) {
        Utils.showMessage('请先登录', 'error');
        return;
      }

      // 获取用户的举报记录
      let reports = DataManager.getReportsByUserId(currentUser.id);
      const reportList = document.getElementById('reportList');
      const noData = document.getElementById('noData');

      // 渲染举报列表
      function renderReports(reportsToRender) {
        if (reportsToRender.length === 0) {
          reportList.classList.add('hidden');
          noData.classList.remove('hidden');
          return;
        }

        reportList.classList.remove('hidden');
        noData.classList.add('hidden');

        reportList.innerHTML = '';
        reportsToRender.forEach(report => {
          const statusClass = report.status === 'processing' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';
          const statusText = report.status === 'processing' ? '处理中' : '已处理';

          const reportCard = document.createElement('div');
          reportCard.className = 'bg-white rounded-lg shadow-md p-4';
          reportCard.innerHTML = `
            <div class="flex justify-between items-start">
              <div>
                <h3 class="text-md font-semibold text-gray-800">举报 ${report.reportedUsername}</h3>
                <p class="text-sm text-gray-600 mt-1">QQ: ${report.reportedQqNumber}</p>
                <div class="flex items-center mt-2">
                  <span class="inline-block px-2 py-1 ${statusClass} text-xs rounded-full">${statusText}</span>
                  <span class="text-xs text-gray-500 ml-2">${Utils.formatDate(report.createTime)}</span>
                </div>
              </div>
              <button class="view-detail px-3 py-1 bg-gray-100 text-gray-700 rounded-md text-sm hover:bg-gray-200 transition-colors duration-200" data-id="${report.id}">
                查看详情
              </button>
            </div>
          `;
          reportList.appendChild(reportCard);

          // 查看详情按钮点击事件
          reportCard.querySelector('.view-detail').addEventListener('click', () => {
            showReportDetail(report.id);
          });
        });
      }

      // 显示举报详情
      function showReportDetail(reportId) {
        const report = DataManager.getReports().find(r => r.id === reportId);
        if (!report) return;

        const modal = document.getElementById('reportDetailModal');
        const content = document.getElementById('reportDetailContent');

        const statusClass = report.status === 'processing' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';
        const statusText = report.status === 'processing' ? '处理中' : '已处理';

        content.innerHTML = `
          <div>
            <h4 class="text-sm font-medium text-gray-500">被举报人</h4>
            <p class="text-gray-800">${report.reportedUsername} (QQ: ${report.reportedQqNumber})</p>
          </div>
          <div>
            <h4 class="text-sm font-medium text-gray-500">涉及群聊</h4>
            <p class="text-gray-800">${report.group}</p>
          </div>
          <div>
            <h4 class="text-sm font-medium text-gray-500">违规类型</h4>
            <p class="text-gray-800">${report.violationType}</p>
          </div>
          <div>
            <h4 class="text-sm font-medium text-gray-500">举报描述</h4>
            <p class="text-gray-800 whitespace-pre-line">${report.description}</p>
          </div>
          ${report.evidence && report.evidence.length > 0 ? `
          <div>
            <h4 class="text-sm font-medium text-gray-500">证据</h4>
            <div class="grid grid-cols-2 gap-2 mt-2">
              ${report.evidence.map(img => `
                <div class="relative">
                  <img src="${img}" class="w-full h-32 object-cover rounded-md">
                  <button type="button" class="absolute top-1 right-1 bg-black bg-opacity-50 text-white rounded-full w-6 h-6 flex items-center justify-center view-image" data-src="${img}">
                    <i class="fa fa-search"></i>
                  </button>
                </div>
              `).join('')}
            </div>
          </div>
          ` : ''}
          <div>
            <h4 class="text-sm font-medium text-gray-500">举报时间</h4>
            <p class="text-gray-800">${Utils.formatDate(report.createTime)}</p>
          </div>
          <div>
            <h4 class="text-sm font-medium text-gray-500">处理状态</h4>
            <span class="inline-block px-2 py-1 ${statusClass} text-xs rounded-full">${statusText}</span>
          </div>
          ${report.status === 'completed' ? `
          <div>
            <h4 class="text-sm font-medium text-gray-500">处理时间</h4>
            <p class="text-gray-800">${Utils.formatDate(report.processingTime)}</p>
          </div>
          <div>
            <h4 class="text-sm font-medium text-gray-500">处理结果</h4>
            <p class="text-gray-800">${report.result}</p>
          </div>
          ` : ''}
        `;

        modal.classList.remove('hidden');

        // 查看图片
        content.querySelectorAll('.view-image').forEach(btn => {
          btn.addEventListener('click', () => {
            const src = btn.getAttribute('data-src');
            // 实际应用中可以使用更高级的图片查看器
            window.open(src, '_blank');
          });
        });
      }

      // 关闭详情模态框
      document.getElementById('closeDetailModal').addEventListener('click', () => {
        document.getElementById('reportDetailModal').classList.add('hidden');
      });

      // 筛选功能
      document.getElementById('statusFilter').addEventListener('change', filterReports);
      document.getElementById('typeFilter').addEventListener('change', filterReports);
      document.getElementById('resetFilter').addEventListener('click', resetFilter);

      function filterReports() {
        const statusFilter = document.getElementById('statusFilter').value;
        const typeFilter = document.getElementById('typeFilter').value;

        let filteredReports = reports;

        if (statusFilter) {
          filteredReports = filteredReports.filter(report => report.status === statusFilter);
        }

        if (typeFilter) {
          filteredReports = filteredReports.filter(report => report.violationType === typeFilter);
        }

        renderReports(filteredReports);
      }

      function resetFilter() {
        document.getElementById('statusFilter').value = '';
        document.getElementById('typeFilter').value = '';
        renderReports(reports);
      }

      // 初始渲染
      renderReports(reports);
    });
  </script>
</body>
</html>